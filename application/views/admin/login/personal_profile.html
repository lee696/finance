<style>
	#userInfo tr:nth-child(odd) {
		width: 110px !important;
		text-align: right !important;
	}
	
	.firstlabel {
		width: 110px;
		text-align: right;
		float: left;
		margin-right: 20px;
	}
	
	.c_items span {
		width: 120px;
		display: inline-block;
		text-align: right;
	}
	
	.c_items label {
		margin-left: 30px;
	}
</style>
<style type="text/css">
	tr td {
		padding: 11px !important;
	}
	.c_items{
		padding:5px;
	}
	
	.widget-main {
		padding: 12px 18px
	}
	img[data]{
		cursor: pointer;
	}
	.div_for_two{
		display: inline-block;
    	width: 38%;
	}
</style>

<div class="row">
	<div class="col-xs-12 col-sm-12 widget-container-col ui-sortable" id="widget-container-col-4" style="padding-right: 12px;">
		<div class="widget-box ui-sortable-handle" id="widget-box-4">
			<!-- #section:custom/widget-box.header.options -->

			<!--<div class="widget-header widget-header-large" style="background: #67809F !important; color: #fff !important;">
				<h4 class="widget-title">个人信息</h4>
				<span contentAuthority="242">
					<div class="widget-toolbar" id="edit" style="margin-left: 13px; ">
						<a href="#" data-action="settings" style="cursor: pointer;color: #fff;">
							<i class="ace-icon fa fa-pencil bigger-135"></i>
							<label style="margin:0;">编辑</label>
						</a>

					</div>
				</span>
				
			</div>-->
			<!-- /section:custom/widget-box.header.options -->
			<div class="widget-body">
				<div class="widget-main" id="userInfo">
					<div class="c_items" > 
							<span class="items_tit">头像：</span>
							<span id="logo" style="position:relative;">
	                           <img style="width: 100%;height:100%"  data="avatar"  src="" alt="">
	                        </span>
	                        <div class="widget-toolbar" id="edit" style="margin-left: 13px; ">
								<a href="#" data-action="settings" style="cursor: pointer;color: #000;">
									<i class="ace-icon fa fa-pencil bigger-135"></i>
									<label style="margin:0;">编辑</label>
								</a>
							</div>
						</div>
					<div class="c_items div_for_two">
						<span class="items_tit">姓名：</span>
						<label data="name"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="账号">账号：</span>
						<label data="username"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">手机号码：</span>
						<label data="mobilePhone"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">密码：</span>
						<label><button type="button" id="changePwd" class="btn btn-info btn-sm">修改密码</button></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">性别：</span>
						<label data="sex"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">生日：</span>
						<label data="birthday"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">所属部门：</span>
						<label data="dep_name"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">角色：</span>
						<label data="role_name"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">部门主管：</span>
						<label data="director_name"></label>
					</div>
					<div class="c_items div_for_two">
						<span class="items_tit">入职时间：</span>
						<label data="employedDate"></label>
					</div>
					<!--<div class="c_items">
						<span class="items_tit">管理权限：</span>
						<label data="employedDate"></label>
					</div>-->
					<div style=" padding-left: 58px;margin: 20px;">
						<button type="button" id="seeMore" class="btn btn-info btn-sm">
                                                查看更多
                    	</button>
					</div>

					<div id="ys" style="display: none;">
						<div class="c_items div_for_two">
							<span class="items_tit">婚姻状态：</span>
							<label data="marriage"></label>
						</div>
						<div class="c_items div_for_two">
							<span class="items_tit">紧急联系人：</span>
							<label data="emergencyContactName"></label>
						</div>
						<div class="c_items div_for_two">
							<span class="items_tit">紧急联系电话：</span>
							<label data="emergencyPhone"></label>
						</div>
						<div class="c_items div_for_two">
							<span class="items_tit">户籍：</span>
							<label data="origin"></label>
						</div>
						<div class="c_items div_for_two">
							<span class="items_tit">身份证号码：</span>
							<label data="identityCode"></label>
						</div>
						<div class="c_items div_for_two">
							<span class="items_tit">通讯地址：</span>
							<label data="mail_address"></label>
						</div>
						<!-- <div class="c_items div_for_two" style="margin-top: 10px;">
							<span class="items_tit">头像：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"  data="avatar" src="" alt="">
	                        </span>
						</div> -->
						<div class="c_items div_for_two" style="margin-top: 10px;">
							<span class="items_tit">身份证扫描件：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"  data="img_card" src="" alt="">
	                        </span>
						</div>
						<div class="c_items div_for_two" style="margin-top: 10px;">
							<span class="items_tit">毕业证扫描件：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"   data="img_school"  src="" alt="">
	                        </span>
						</div>
						<div class="c_items div_for_two" style="margin-top: 10px;">
							<span class="items_tit">资格证扫描件：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"   data="img_qualifications"  src="" alt="">
	                        </span>
						</div>
						<div class="c_items div_for_two" style="margin-top: 10px;">
							<span class="items_tit">劳动合同扫描件：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"   data="img_labour"  src="" alt="">
	                        </span>
						</div>
						<div class="c_items div_for_two" style="margin-top: 10px;"> 
							<span class="items_tit">其他证件扫描件：</span>
							<span id="logo" style="position:relative;">
	                           <img style="display: none;width: 100%;height: 98px;"  data="img_other"  src="" alt="">
	                        </span>
						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="label_popup" id="label_popup" style="position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;display:none;">
			<div style="width:400px;margin:39px auto;z-index:1060;background:#fff;position:relative;border:1px solid #ddd;
					    box-shadow:0px 0px 15px rgba(0, 0, 0, 0.2);">
				<div style="padding:15px;border-bottom:1px solid #ddd;">
					<span style="display: inline-block;">修改密码</span>
					<a href="javascript:;" class="close_label" style="float: right;"><i class="fa fa-times" aria-hidden="true"></i></a>
				</div>
				
				<div style="padding: 10px 50px;">
					<label>原始密码:</label>
					<input type="password" msg="请输入正确的原始密码" validate="password" width="200px" style="margin: auto;" placeholder="原始密码" id="labelName" />
					<!--<hr>-->
				</div>
				<div style="padding: 10px 50px;">
					<label>更新密码:</label>
					<input type="password" msg="请输入正确的更新密码" validate="password" width="200px" style="margin: auto;" placeholder="更新密码" id="labelName" />
				</div>
				<div style="padding: 10px 50px;">
					<label>重复密码:</label>
					<input type="password" msg="请输入正确的重复密码" validate="password" width="200px" style="margin: auto;" placeholder="重复密码" id="labelName" />
				</div>
				<div style="padding:15px;text-align:right;">
					<button class="close_label">关闭</button>
					<button class="hold">保存</button>
				</div>
			</div>
		</div>

		<!-- 放大图片 -->
		<div id="big_pic" style="cursor:pointer;display:none;position: fixed; top: 0px; left:0; background: rgba(0, 0, 0, 0.5);bottom:0;right: 0px; width: 100%; height: 100%; z-index: 1053; text-align: center;">
		    <div style="margin: 10% auto;height: 70%;">
		        <img style="height: 100%" src="">
		    </div>
		</div>

		<div class="row" id="template" style="display:none;">
			<div class="widget-box">
				<!-- <div class="widget-header widget-header-small">
					<h5 id="editTitile" class="widget-title lighter">编辑信息</h5>
				</div> -->
				<div class="row">
					<div class="col-xs-12">
						<form class="item_form" role="form" id="">
							<div class="form-group">
								<label style="width: 100px;"> 姓名： </label>
								<input type="text" class="in_num " addfield="name" />
							</div>
							<div class="form-group">
								<label style="width: 100px;"> 手机号码： </label>
								<input type="tel" class="in_num " addfield="mobilePhone" msg="请输入正确的手机号码" validate="phone" maxlength="11" />

							</div>
							<div class="form-group">
								<label style="width: 100px;"> 生日： </label>
								<div class="input-group" style="display: inline-flex; width: 180px;">
									<input class="date-timepicker1 required" addfield="birthday" msg="生日不能为空" style="padding:5px;height: 30px; width: 150px;">
									<span class="input-group-addon" style="width:30px;height:30px;">
					                        <i class="fa fa-clock-o bigger-110" style="position:relative;right:3px;"></i>
					                    </span>
								</div>
							</div>
							<div class="form-group">

								<label style="width: 100px;margin-right:5px;"> 头像： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="avatar" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload0" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>
								
							</div>

							<!-- <div class="form-group">
								<label style="width: 100px;"> 婚姻状态： </label>
								<select id="depart" addfield="marriage">
									<option value="0">未婚</option>
									<option value="1">已婚</option>
									<option value="2">离婚</option>
								</select>
								<label style="width: 100px;"> 户籍： </label>
								<input type="text" class="in_num required" addfield="origin" />
							</div>
							<div class="form-group">
								<label style="width: 100px;"> 紧急联系人： </label>
								<input type="text" class="in_num required" addfield="emergencyContactName" />
								<label style="width: 100px;"> 紧急联系人电话： </label>
								<input type="text" class="in_num required" addfield="emergencyPhone" maxlength="11" />
							</div>
							<div class="form-group">
								<label style="width: 100px;"> 身份证号码： </label>
								<input type="text" class="in_num required" addfield="identityCode" maxlength="18" />
								<label style="width: 100px;"> 通讯地址： </label>
								<input type="text" class="in_num required" addfield="mail_address" />
							</div>
							<div class="form-group">

								<label style="width: 100px;margin-right:5px;"> 头像： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="avatar" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload0" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>

								<label style="width: 100px; margin-right:5px;"> 身份证扫描件： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="img_card" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload1" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>
								
							</div>
							<div class="form-group">
								
								<label style="width: 100px;margin-right:5px;"> 毕业证书扫描件： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="img_school" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload2" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>

								<label style="width: 100px;margin-right:5px;"> 资格证件扫描件： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="img_qualifications" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload3" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>
								
							</div>

							
							<div class="form-group">

								<label style="width: 100px;margin-right:5px;"> 劳动合同扫描件： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="img_labour" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload4" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>
								
								<label style="width: 100px;margin-right:5px;"> 其他证件扫描件： </label>
								<div class="input-group js_photo" style="display: inline-flex; width: 180px;">
									<label>
										<div class="imgCon">
											<img src="/resource/adimin/assets/images/avatar.png" addfield="img_other" data-url="" />
											<div class="del">
												<span class=" fa fa-pencil">
							                       			</span>
												<input type="file" class="upload5" style="opacity: 0;" />
											</div>
										</div>
									</label>
								</div>
									
							</div> -->
						</form>
					</div>
					<!-- /.col -->
					<!--保存按钮-->
					<div class=" padding-4 clearfix">
						<div class="btn-group pull-right">
							<button class="btn btn-info" id="add">
                                                <i class="fa fa-check" aria-hidden="true"></i>
                                                保存
                                            </button>
						</div>
					</div>
				</div>

			</div>
		</div>

	</div>
</div>
</div>
{% include 'admin/mark.html' %}
<script src="/resource/adimin/assets/js/LocalResizeIMG.js"></script>
<script src="/resource/adimin/assets/js/src/public.js"></script>
<script src="/resource/adimin/components/select2/dist/js/select2.js"></script>
<script>
	jQuery(function() {
		cs.getNodes([242,243]);
		var userInfo = "";//用户信息
		var defaultImgSrc ="/resource/adimin/assets/images/avatar.png";//没有照片用默认的图片
		// var employees = {};//员工信息

		// ykp.doAjax({
		// 	async:false,
		// 	url: '/api/api_employees/f7',
		// 	method: 'post',
		// 	data: {
		// 		select:'bmm_employees.id,bmm_employees.name'
		// 	},
		// 	success: function(res) {
		// 		var data = res.data;
		// 		for(var i in data){
		// 			employees[data[i]['id']] =data[i]['name']; 
		// 		}
		// 	}
		// })

		cs.getNodes();

		//放大图片
		bigPic();
		function bigPic(){
			$('img[data]').unbind('click').click(function(){
				$('#big_pic').show().find('img').attr('src',$(this).attr('src'));

				$('#big_pic').unbind('click').click(function(){
					$(this).hide();
				});
			});
		}

		//获取用户信息
		getuserInfo();
		function getuserInfo() {
			var id = ykp.getCookie("uid");
			ykp.doAjax({
				url: '/api/api_employees/get_info',
				method: 'post',
				data: {
					id:id
				},
				success: function(res) {
					var data = res.data;
					//console.log(data);
					userInfo = data;
					var maritalStatus = ['在职','请假','离职'];//在职状态
					var sex = ['未知','男','女'];//性别
					var marriage = ['未婚','已婚','离婚'];//婚姻状态
					var field = '';
					$('[data]').each(function(i,e) {
						field = $(this).attr('data');
						//对日期数据做额外处理
						if($(this).attr('data') == 'employedDate' || $(this).attr('data') == 'birthday') {
							$(this).text(data[field] != '0' ? cs.getNowTime(data[field]) : '');
							return true;
						}
						//对图片数据做额外处理
						if($(this).attr('data') == 'img_card' || $(this).attr('data') == 'avatar' || $(this).attr('data') == 'img_school' || $(this).attr('data') == 'img_qualifications' || $(this).attr('data') == 'img_labour' || $(this).attr('data') == 'img_other') {
							if(data[field]) {
								$(this).attr('src', data[field]);
								$(this).attr('data-url', data[field]);
								$(this).show();
							}else{
								$(this).attr('src', defaultImgSrc);
							}
							return true;
						}
						if($(this).attr('data') == 'maritalStatus'){
							$(this).text(maritalStatus[data[field]]);
							return true;
						}
						if($(this).attr('data') == 'sex'){
							$(this).text(sex[data[field]]);
							return true;
						}
						if($(this).attr('data') == 'marriage'){
							$(this).text(marriage[data[field]]);
							return true;
						}
						if($(this).attr('data') == 'bmm_department.name'){
							$(this).text([data['bmm_department.name']]);
							return true;
						}
						if($(this).attr('data') == 'role_id'){
							$(this).text([data['bmm_department.name']]);
							return true;
						}
						$(this).text(data[field]);
					})

				}
			})
		}

		$('#edit').click(function() {
			//编辑
			showMark('#template');
			cs.timeplug();
			$('#showBox .title').text('编辑个人信息');
			var field = '';
			$('#templateCon [addfield]').each(function(i,e) {
				field = $(this).attr('addfield');
				if($(this).attr('addfield') == 'img_card' || $(this).attr('addfield') == 'img_school' || $(this).attr('addfield') == 'img_qualifications' || $(this).attr('addfield') == 'img_labour' || $(this).attr('addfield') == 'img_other' || $(this).attr('addfield') == 'avatar') {
					if(userInfo[field]) {

						$(this).attr('src', userInfo[field]);
						$(this).attr('data-url', userInfo[field]);
					}else{
						$(this).attr('src', defaultImgSrc);
					}
					return true;
				}

				$(this).attr('addfield') == 'birthday' ? $(this).val(userInfo[field] != '0' ? cs.getNowTime(userInfo[field]) : '') : $(this).val( userInfo[field]);
			});

			$('#templateBox input[type=file]').each(function(i) {
				$('#templateBox .upload' + i).click(function() {
					cs.imgResize('#templateBox .upload' + i, function(res) {
						$('#templateBox').find('.js_photo').eq(i).find('img').attr('src', res.data.url);
						$('#templateBox').find('.js_photo').eq(i).find('img').attr('data-url', res.data.url);
					})
				})
			});

			$('#templateBox #add').click(function() {
				var data = {
					id: ykp.getCookie("uid")
				};
				$('#templateBox .item_form').find('input[addfield],select[addfield]').each(function(i, element) {
						if($(this).val() == "") {
							ykp.prompt($(this).prev().text() + "不能为空！");
							status = false;
							return false;
						}
						
						if($(this).attr('addfield') == 'birthday'){
							data[$(this).attr('addfield')] = new Date($(this).val()) / 1000;
							return true;
						}
						
						data[$(this).attr('addfield')] = $(this).val();
				});
				$('#templateBox').find('img').each(function(i,e) {
					if($(this).attr('data-url') != "") {
						data[$(this).attr('addfield')] = $(this).attr('data-url');
					}
				});
				ykp.doAjax({
					url: '/api/api_employees/edit_info',
					method: "post",
					data: data,
					success: function(res) {
						ykp.prompt('编辑成功');
						cs.close();
						getuserInfo();
					}
				})
			});

		})

		$('#seeMore').click(function() {
			if($(this).hasClass('see')) {
				$(this).text('查看更多').removeClass('see');
				$('#ys').hide();
			} else {
				$('#ys').show();
				$(this).addClass('see').text('取消查看');
			}

		})

		//修改密码
		$('#changePwd').unbind('click').click(function() {
			var id = ykp.getCookie("uid");
			$('#label_popup').show();
			$('#label_popup .hold').click(function() {
				var result = ykp.getFormData('#label_popup',true);
				var yPaw = $('#label_popup').find('input').eq(0).val();
				var nPwd = $('#label_popup').find('input').eq(1).val();	
				var nPwd1 = $('#label_popup').find('input').eq(2).val();	
				if(result.status) {
					if(nPwd != nPwd1){
						ykp.prompt('2次新密码不一致');
						return false;
					}
					ykp.doAjax({
						url: "/api/api_employees/change_pwd",
						data: {
							password: yPaw,
							newPassword: nPwd,
							id:id
						},
						success: function(res) {
							if(res.code == 200) {
								ykp.prompt('修改成功');
								$('#label_popup').find('input').val('');
								$('.close_label').parents('.label_popup').fadeOut();
							}else {
								ykp.prompt(res.msg);
								$('#label_popup').find('input').val('');
								$('.close_label').parents('.label_popup').fadeOut();
							}
						}
					})
				}
				
				
			})
			cs.closePop();
		})

	

	})
</script>