<style type="text/css">
	#showBox .form_data label {
		width: 130px;
	}
	
	#showBox .form_data input,
	#showBox .form_data textarea,
	#showBox .form_data select {
		width: 46%;
	}
</style>
<div class="widget-main">
	<div class="row">
		<!-- <h3 class="header smaller lighter blue">退单</h3> -->
		<div class="actions" id="topTool">
			<!--<input type="text" pts="0" class="" placeholder="审批号">-->
			<div class="col-sx-4" style=" float: left;margin-right: 5px;">
	            <input type="text" pts="0" sear="khm_customer.name" class="" placeholder="企业名称">
			</div>
			<div class="col-sx-4" style=" float: left;margin-right: 5px;">
	            <select style="width: 180px"  class="advandced-search select2-hidden-accessible" tabindex="-1" sear="ckm_retreat.fuze_id" pts=3 aria-hidden="true">
					<option value="">负责人</option>
				</select>
			</div>
			<div class="col-sx-4" style=" float: left;margin-right: 5px;">
	            <button id="search" title="搜索" class="btn btn-info btn-sm">
	            	<i class="fa fa-search"></i>
	            </button>
			</div>
			<div class="col-sx-4" style=" float: left; margin-right: 5px;">
				<button id="heightsearch" title="高级搜索" type="button" class="btn btn-info btn-sm" style="background-color: #00c0ef !important;">
                    <i class="fa fa-filter"></i>
                </button>
			</div>
			<div class="col-sx-4" style=" float: left;margin-right: 5px;">
	            <button id="flush" type="button" title="刷新" class="btn btn-info btn-sm" style="background-color: #32CD32	 !important;">
	                <i class="fa fa-refresh"></i>
	            </button>
			</div>
			
			<div id="heightsearch1" class="col-sx-12" style="position: absolute;margin-top: 30px; background: #fff; z-index: 1041;padding: 10px 0px; display: none;">
				<div class="row" id="SearchCon">
				
				</div>

			</div>
		</div>
	</div>
	<div class="custom_table">
		<table id="dynamic-table">
			<thead>
				<tr class="thColor">
					<th>操作</th>
					<th data-num="1">企业名称</th>
					<th data-num="2">服务月份</th>
					<th data-num="3">负责人</th>
					<th data-num="4">退单时间</th>
					<th data-num="5">退单原因</th>
					<th data-num="6">入库状态</th>
				</tr>
			</thead>
			<tbody id="datalist">

			</tbody>
		</table>
	</div>
	<div align="center" style="margin-top: 20px; margin-bottom: 20px;">
		<div align="left" style="padding-left: 15px; float: left; width: 10%;" id="num"></div>
		<!--<div id="pagination" style="float: left; width: 80%; height: 25px;"></div>-->
		<div id="pageBar" class="pagination"></div>
		<div align="right" style="float: right;  width: 10%;">
			<select style="width: 100px;" id="changePageNum">
				<option value="10">每页10条</option>
				<option value="20">每页20条</option>
				<option value="50">每页50条</option>
				<option value="100">每页100条</option>
				<option value="200">每页200条</option>
			</select>
		</div>
	</div>
	<div class="popup_new" style="display:none">
		<div class="row">
			<form class="item_form" role="form">
				<div class="form_data">
					<label> 配送状态： </label>
					<select addfied="status">
						<option value="">- - - 请选择 - - -</option>
						<option value="0">未配送</option>
						<option value="1">已成功</option>
						<option value="2">未成功</option>
					</select>
				</div>
				<!--<div class="form_data">
					<label> 配送次数： </label>
					<input type="number" addfied="num">
				</div>-->
				<div class="form_data">
					<label> 退单时间： </label>
	                <div class="input-group" style="display: inline-flex; width: 180px;">
					    <input class="date-timepicker1 required" addfied="creata_at" msg="入库时间不能为空" class="form-control" style="padding:5px;height: 30px; width: 180px!important;">
					    <span class="input-group-addon" style="width:30px;padding:7px 10px;height:30px;">
	                        <i class="fa fa-clock-o bigger-110" style="position:relative;right:3px;"></i>
	                    </span>
					</div>
				</div>
				<div class="form_data" style="margin-bottom:5px;">
					<label style="position:relative;top:-15px;"> 退单原因：</label>
					<textarea addfied="reason" style="padding:5px"></textarea>
				</div>
				<div class="form_data" style="margin-bottom:5px;">
					<label style="position:relative;top:-15px;"> 备注： </label>
					<textarea addfied="remark" style="padding:5px"></textarea>
				</div>
			</form>
			<div id="sendMsg" customer_id="" style="height: 30px;line-height: 40px;">
				<label style="margin-left:5px" >是否发送短信：</label>
				<input type="radio" value="1" name="is_send" checked="true">是
				<input type="radio" value="2" name="is_send">否
			</div>
			<div class="popup_button">
				<button class="sure_button">
                        <i class="fa fa-check" aria-hidden="true"></i>
                        保存
                    </button>
			</div>
		</div>
	</div>
	
	
	<div id="jieTable" style="display: none;">
		<div id="template1" style="display: none;">
			<div style="margin-top:15px;">
				<label>公司名称： </label>
				<span style="display: inline-block; width: 174px;" class="name"></span>
				<label> 客户仓位： </label>
				<span style="display: inline-block; width: 174px;" class="caddress"></span>
			</div>
			<div style="margin-top:15px;">
				<label>联系人： </label>
				<span style="display: inline-block; width: 174px;" class="people"></span>
				<label> 联系电话： </label>
				<span style="display: inline-block; width: 174px;" class="tel"></span>
			</div>
			<div style="margin-top:15px;">
				<label> 地址： </label>
				<span style="display: inline-block; width: 174px;" class="address"></span>
				<label> 负责人： </label>
				<input class="required" title_="name" addTitle="fPeople" class="fPeople" />
			</div>

			<div style="margin-top:15px;">
				<label>其他代办事项： </label>
				<input class="required rmark" title_="name" />
				<label> 是否配送成功： </label> 否
				<input type="radio" name="status" value="0" checked="" title_="name" /> 是
				<input type="radio" name="status" value="1" title_="name" />
			</div>
			<!--<div style="margin-top:15px;">
					<label> 客户仓位： </label>
					<input class="required kcang" title_="name" />
				</div>-->
		</div>
	<div id="template2">
		<div style="margin-top:20px;margin-bottom:20px;" class="buttons">
			<button class="btn btn-info btn-sm active">凭证交接</button>
			<button class="btn btn-info btn-sm">票据交接</button>
			<button class="btn btn-info btn-sm">证件交接</button>
		</div>
		<div class="connects-content">
			<div class="voucher">
				<table>
					<thead>
						<tr>
							<th>凭证月份</th>
							<th>凭证名称</th>
							<th>数量(本)</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td id="month">
							</td>
							<td>
								<input class="required" />
							</td>
							<td>
								<input class="required" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div>
				<table class="bill" style="display:none;">
					<thead>
						<tr>
							<th>操作</th>
							<th>票据类别</th>
							<th>数量(张)</th>
							<th>金额(元)</th>
						</tr>
					</thead>
					<tbody id="ticketBody">
						<tr>
							<td>
								<a href="javascript:;" class="addTicket">+</a>
							</td>
							<td>
								<select>
									<option value="2">收入发票</option>
									<option value="3">进项发票</option>
									<option value="4">未开票</option>
									<option value="5">费用票</option>
									<option value="6">房租发票</option>
									<option value="7">水电发票</option>
									<option value="8">银行对账单</option>
									<option value="9">银行回单</option>
									<option value="10">海关发票</option>
									<option value="11">支票</option>
									<option value="12">承兑发票</option>
									<option value="13">其他发票</option>
								</select>
							</td>
							<td>
								<input class="required" />
							</td>
							<td>
								<input class="required" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div>
				<table class="certificate" style="display:none;">
					<thead>
						<tr>
							<th>操作</th>
							<th>证件名称</th>
							<th>数量(个)</th>
						</tr>
					</thead>
					<tbody id="cardBody">
						<tr>
							<td>
								<a href="javascript:;" class="addCard">+</a>
							</td>
							<td>
								<select>
									<option value="14">营业执照正本</option>
									<option value="15">营业执照副本</option>
									<option value="16">公章</option>
									<option value="17">财务章</option>
									<option value="18">私章</option>
									<option value="19">发票章</option>
									<option value="20">开户许可证</option>
									<option value="21">机构信用代码证</option>
									<option value="22">海关证书</option>
									<option value="23">进出口经营许可证</option>
									<option value="24">检验检疫备案表</option>
									<option value="25">外币账户备案表</option>
								</select>
							</td>
							<td>
								<input class="required" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div style="margin-top:15px">
			<label style="float:left;width:36px;">备注：</label>
			<textarea style="margin-left:5px;width:calc(100% - 41px);resize:none;"></textarea>
		</div>
		<div style="margin-top:15px">
			<label style="float:left;margin-bottom:0;padding:2px 0;width:87px;">是否配送成功：</label>
			<input type="radio" name="choose">是
			<input type="radio" name="choose" style="margin-left:5px;">否
		</div>
	</div>
	<div style="text-align:center;margin-top:15px;">
		<span class="msg" style="margin-left:calc(50% - 49px);float:left;line-height:34px;display:none;color:red;"></span>
		<button class="sure_button add template1">
            <i class="fa fa-check" aria-hidden="true"></i>
              	保存
        </button>
	</div>
</div>

<!-- 详情 -->
<div class="row" id="template" style="display:none;width:678px;">
				<table width="100%" style="margin-bottom:15px;">
					<tr style="">
						<td style="text-align: right !important">公司名称:</td>
						<td style="text-align: left !important">
							<span class="disData0"></span>
						</td>
						<td style="text-align: right !important">服务月份:</td>
						<td style="text-align: left !important">
							<span class="disData1"></span>
						</td>
					</tr>
					<tr style="">
						<td style="text-align: right !important">负责人:</td>
						<td style="text-align: left !important">
							<span class="disData2"></span>
						</td>
						<td style="text-align: right !important">退单时间:</td>
						<td style="text-align: left !important">
							<span class="disData3"></span>
						</td>
					</tr>
					<tr style="">
						<td style="text-align: right !important">退单原因：</td>
						<td style="text-align: left !important">
							<span class="disData4"></span>
						</td>
						<td style="text-align: right !important">入库状态：</td>
						<td style="text-align: left !important">
							<span class="disData5"></span>
						</td>
					</tr>
					
				</table>
		</div>





	<!-- 审批回复 -->
	<div class="label_popup" id="feedBack" style="position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;display:none;">
		<div style="width:400px;margin:39px auto;z-index:1060;background:#fff;position:relative;border:1px solid #ddd;
            box-shadow:0px 0px 15px rgba(0, 0, 0, 0.2);">
			<div style="padding:15px;border-bottom:1px solid #ddd;">
				<span style="display: inline-block;">请填写驳回原因</span>
				<a href="javascript:;" class="close_label" style="float: right;"><i class="fa fa-times" aria-hidden="true"></i></a>
			</div>
			<div style="padding: 10px 50px;">
				<input type="text" width="200px" style="margin: auto;" id="labelName" />
				<!--<hr>-->
			</div>
			<div style="padding:15px;text-align:right;">
				<button class="close_label">关闭</button>
				<button class="hold">保存</button>
			</div>
		</div>
	</div>
	
	
	{% include 'admin/mark.html' %} {% include 'admin/customerDetail.html' %}
</div>
<script src="/resource/adimin/assets/js/src/public.js"></script>
<script src="/resource/adimin/components/select2/dist/js/select2.js"></script>
<script type="text/javascript">
	$(function() {
		var order ='ckm_retreat.id desc';
		var page_size = 10;
		var filter ='';
		//获取所有员工
		var employees = {};
        ykp.doAjax({
        	async:false,
            url:'/api/api_employees/f7',
            method:'post',
            data:{
                select:'bmm_employees.id,bmm_employees.name'
            },
            success:function(res){
                var data = res.data;
                $('.advandced-search').select2({allowClear:true});
                for(var i in data){
                	if(data[i]['name']) {
                    employees[data[i]['id']] =data[i]['name'] ;
                    $('.advandced-search').append(new Option(data[i]['name'],data[i]['id']));
                }
                }
            }
        });
		//通用排序
		cs.general_sort({
			url: '/api/api_accountancies/retreat_grid',
			method: 'post',
			data: {
				filter: "",
				limit: page_size,
			},
			pageBar: {
				id: '.pageBar'
			},
			contentId: "#datalist", //默认排序
			initOrder: "", //初始化sort
			defaultOrder: order,
			params: [{
				id: "#dynamic-table",
				field: ["", "khm_customer.id","ckm_retreat.month",  "ckm_retreat.fuze_id", "ckm_retreat.creata_at", "ckm_retreat.reason", "jzm_send_info.status",]
				
			}]
		}, function(res, _sort_role) {
			sort_role = _sort_role;
			addList(res);
		});
		
		search();
		function search() {
			var data = {
				url: '/api/api_accountancies/retreat_grid',
				method: 'post',
				data: {
					limit: page_size,
					order: order
				}
			}
			cs.doSearch('#search', data, 'filter', false, function(res,_filter) {
				filter = _filter;
				if(res.data.items == "") {
					setTimeout(function(){
                        ykp.prompt('暂无数据！');
                    },1000);
					$('#datalist').html('<tr><td colspan="30"><div class="table-actions clearfix"></div> <div style="text-align: center;color:#7d7d7d" class="page">暂无数据</div></td></tr>');
					return false;
				} else {
					addList(res);
				}
			})
		}
		
			getSearch();	
		function getSearch() {
			ykp.setCookie("filter", "");
			ykp.setCookie("where", "");
			var list = [
				{name:"企业名称",search:"khm_customer.name",type:"text"},
				{name:"服务月份",search:"ckm_retreat.month",type:"text"},
				{name:"负责人",search:"ckm_retreat.fuze_id",type:"select",url:"/api/api_employees/f7",key:"people"},
				{name:"退单时间",search:"ckm_retreat.creata_at",type:"time"},
				{name:"退单原因",search:"ckm_retreat.reason",type:"text"},
				{name:"入库状态",search:"jzm_send_info.status",type:"select",option:[{val:"3",text:"待入库"},{val:"5",text:"入库失败"},{val:"4",text:"入库成功"}]},
			];
			
			cs.getSearch({
				list:list,
				el:"#heightsearch",
				el1:"#heightsearch1"
			},dohSearch);
			function dohSearch() {
				var data = {
					url: '/api/api_accountancies/retreat_grid',
					methods: 'post',
					data: {
						page_size: page_size,
						order:order,
						filter:'filter'
					}
				}
				cs.hSearch('.search1', data, 'filter', false, function(res, _filter) {
					filter = _filter;
					$('.in').removeClass('modal-backdrop');
					$("#heightsearch1").slideUp();
					$("#heightsearch").removeClass('active').css('z-index', '');
					if(res.data.items == "") {
						setTimeout(function(){
	                        ykp.prompt('暂无数据！');
	                    },1000);
						$('#datalist').html('<tr><td colspan="30"><div class="table-actions clearfix"></div> <div style="text-align: center;color:#7d7d7d" class="page">暂无数据</div></td></tr>');
						return false;
					}
					addList(res);
				})
			}					
		}
		
	 	$('.myFilter').click(function() {
            if (!$(this).hasClass('clc')) {
                $(this).addClass('clc').siblings().removeClass('clc');
            }
            var data = {
                "limit": page_size,
                'page':1,
                'order':order
            }
            var filter_ =  $(this).attr('data-status');
            if (filter_ == 'a') {
                getList(1);
                return;
            }
            data['filter'] = 'ckm_retreat.auth_status = '+filter_;
            getList_2(data);
            
        })

        $('#filterBtns a').mouseover(function(){
            $(this).addClass('over');
        })
        $('#filterBtns a').mouseout(function(){
            $(this).removeClass('over');
        })

        function getList_2(data) {
			ykp.list({
				url: '/api/api_accountancies/retreat_grid',
				method: 'post',
				data: data,
				pageBar: {
					id: '#pageBar'
				},
				loadList: function(res) {
					if(res.data.items == "") {
						setTimeout(function(){
                        ykp.prompt('暂无数据！');
                    },1000);
						$('#datalist').html('<tr><td colspan="30"><div class="table-actions clearfix"></div> <div style="text-align: center;color:#7d7d7d" class="page">暂无数据</div></td></tr>');
					}else{
						addList(res);
					}
				}
			});
		}


		 
		
		$('#changePageNum').change(function(){
			page_size = $(this).val();
			ykp.setCookie('page_size',page_size);
			getList(1);
		})
		
		getList(1);
		
		function getList(current) {
			ykp.list({
				url: '/api/api_accountancies/retreat_grid',
				method: 'post',
				data: {
					page: current,
					limit: page_size,
					order: order
				},
				pageBar: {
					id: '#pageBar'
				},
				loadList: function(res) {
					if(res.data.items == "") {
						setTimeout(function(){
                        ykp.prompt('暂无数据！');
                    },1000);
						$('#datalist').html('<tr><td colspan="30"><div class="table-actions clearfix"></div> <div style="text-align: center;color:#7d7d7d" class="page">暂无数据</div></td></tr>');
					}else{
						addList(res);
					}
				}
			});
		}
		
		$('#flush').click(function(){
			$('[sear="khm_customer.name"]').val('');
			$('[sear="ckm_retreat.fuze_id"]').val('').trigger('change');
			ykp.setCookie("filter", "");
			ykp.setCookie("where", "");
			filter = '';
			getList();
		})

		
		function addList(res) {
			var data = res.data.items;
			var content = '';
			var html = '';
			var ths = $('.thColor th');
			var styles = [];
			for(i = 0; i < ths.length; i++) {
				styles.push(ths.eq(i).css('display'));
			}
			var auth_status = ['待审核', '未通过', '已通过','未开始'];
			var status = ['未配送', '成功', '未成功'];
			var status1 = {'-1':'出库失败', '0':'出库中','1': '待送单','2':'送单成功','3':'待入库','4':'入库成功','5':'入库失败'};
			//<a href="#"><span style="cursor: pointer" id="" class="info sdetail">详情&nbsp</span></a>
			//<a href="#"> <span style="cursor: pointer" id="edit" class="edit">编辑&nbsp</span></a>
			var tstatus = {
				3:"待入库",
				4:"已入库",
				5:"入库失败",
			}
			//审批权限为true可以审批,为false不可审批
			var spApp = cs.approve_authority({name:'退单',nodes:[156]});
			var cxApp = cs.approve_authority({name:'退单',nodes:[269]});
			var edit_statu = cs.getNodes([155],true);
			for(var i in data) {

				content += `<tr data-id='${data[i]["ckm_retreat.id"]}'  data-status="${data[i]['ckm_retreat.auth_status']}">
						<td style="display: ${styles[0]}">
						<label class="pos-rel">
                    		<a href="#" class="pos-rel btOrange info" title="详情" style="color:#fff !important"><i class="fa fa-info "></i></a>
                        </label>
						</td>

						<td data-num = "1" style="display: ${styles[1]}" data-id="${data[i]['khm_customer.id']}" data-cid="${data[i]['khm_customer.id']}">
							<a class="customerDetail pos-rel" href="#">
								${data[i]['khm_customer.name']}
			 				 </a>
			 				 <label class="pos-rel">
				 				<i class="iconBnt fa fa-info-circle" style="color:${data[i]['Remark'].length > 0 ? 'red' : ''}" data-rel="tooltip" data-placement="right" data-html="true" title="${cs.getRemark(data[i]['Remark'])}" ></i>
			 				 </label>
						</td>
						<td data-num = "2" style="display: ${styles[2]}">
							${data[i]['ckm_retreat.month']}
						</td>
						<td data-num = "3"  style="display: ${styles[3]}">
							${employees[data[i]['ckm_retreat.fuze_id']]}
						</td>
						<td data-num = "4" style="display: ${styles[4]}" >
							${data[i]['ckm_retreat.creata_at'] != '0' ? cs.getNowTime(data[i]['ckm_retreat.creata_at'],true) : ''}
						</td>
						<td data-num = "5" style="display: ${styles[5]}">
							${data[i]['ckm_retreat.reason']}
						</td>
						<td data-num = "6" style="display: ${styles[6]}">
							${data[i]['jzm_send_info.status']?status1[data[i]['jzm_send_info.status']]:''}
						</td>
					</tr>`;
			}

			$('#datalist').html(content);
			custom.showReamrk();
			$("[data-rel='tooltip']").tooltip();
			custom.get_custom_info();

			$("#datalist tr").find('.sp').click(function() {
				var status = $(this).attr('data-status');
				var id = $(this).parents('tr').attr('data-id');
				changeStatus(status, id);
			})

			//编辑
			$('.edit').click(function() {
				var id = $(this).parents('tr').attr('data-id');
				var index = $(this).parents('tr').index();
				var _data = data[index];

				console.log(_data);
				showMark('.popup_new');
				$('#showBox .title').text('编辑');

				var field = '';
				$('#templateCon [addfied]').each(function(i,e){
					field = 'ckm_retreat.' + $(this).attr('addfied');
					if($(this).attr('addfied') == 'creata_at'){
						$(this).val(cs.getNowTime(_data[field]));
						return true;
					}
					$(this).val(_data[field]);
				});

				cs.timeplug();
				var customer_id = $(this).parents('tr').find('[data-num="3"]').attr('data-id');
				var param = {
					name:$(this).parents('tr').find('[data-num="3"]').attr('data-cid'),
					time:$(this).parents('tr').find('[data-num="4"]').text().trim()
				}
				$('#templateBox .sure_button').click(function() {
					var status = false;
					var data = {};
					var is_send = false;
					if ($('#templateCon #sendMsg input:checked').val()==1) {
						is_send = true;
					}
					$('#templateBox').find('[addfied]').each(function(i) {
						if($(this).attr('addfied') == 'creata_at' && $(this).val() == '') {
							ykp.prompt("配送时间不能为空！");
							status = false;
							return false;
						} else {
							if($(this).val() != "") {
								data[$(this).attr('addfied')] = $(this).attr('addfied') == 'creata_at' ? new Date($(this).val()) / 1000 : $(this).val();
								status = true;
							}
						}
					})
					var type = $('#templateCon [addfied="status"]').val() =='1'?'送单成功':'送单失败';
					if ($('#templateCon [addfied="status"]').val() !='1') {
						param['msg'] = $('#templateCon [addfied="reason"]').val();
					}
					
					if(status) {
						data.id = id;
						ykp.doAjax({
							url:'/api/api_accountancies/edit_retreat',
							method:'post',
							data:data,
							success:function(res) {
								ykp.prompt('编辑成功');
								if (is_send) {
									sendMsg(customer_id,type,param);
								}
								cs.close();
								getList(1);
							}
						})
					}
				})
			})

			//详情
			$('.info').click(function() {
				var cid = $(this).parents('tr').attr('data-id');
				showMark("#template");
				$('#showBox .title').text('退单详情');
				//var emps=allemp();
				var empname;
				var status = ['待审核', '未通过', '已通过'];
				var status_2 = ['未配送', '配送成功', '配送失败'];
				var status1 = {'-1':'出库失败', '0':'出库中','1': '带送单','2':'送单成功','3':'带入库','4':'入库成功','5':'入库失败'};
				var tstatus = {
					3:"待入库",
					4:"已入库",
					5:"入库失败",
				}
				ykp.doAjax({
					url: '/api/api_accountancies/retreat_grid',
					methods: 'post',
					data: {
						filter: 'ckm_retreat.id=' + cid
					},success:function(res){
						var data=res.data.items[0];
						$('#templateCon .disData0').text(data['khm_customer.name']);
						$('#templateCon .disData1').text(data['ckm_retreat.month']);
						$('#templateCon .disData2').text(employees[data['ckm_retreat.fuze_id']]);
						$('#templateCon .disData3').text(cs.getNowTime(data['ckm_retreat.creata_at']));
						$('#templateCon .disData4').text(data['ckm_retreat.reason']);
						$('#templateCon .disData5').text(status1[data['jzm_send_info.status']]);
                        $("#temHeader").width($("#showBox").width()-47);
					}
				})
			})
		}

		function sendMsg(id,type,param){
			ykp.doAjax({
				url:'/api/api_common/send_customer',
				data:{
					customer_id:id,
					type:type,
					param:JSON.stringify(param)
				},
				method:'post',
				success:function(res){
					ykp.prompt('短信发送成功！');
				}
			})
		}

		function changeStatus(status, id) {
			//console.log(status, id)
			var data = {
				url: '/api/api_accountancies/sh_retreat',
				methods: 'post',
				data: {
					id: id,
					auth_status: status
				}
			}
			if(status == 1) {
				$('#feedBack').show();
				$('#feedBack .hold').click(function() {
					var approve_reply = $('#feedBack').find('input').val();
					if(approve_reply == '') {
						ykp.prompt('不能为空！');
						return false;
					}
					data.data.approve_reply = approve_reply.trim();
					data.data.approve_reply = approve_reply;
					setStatus(data);
					$('.close_label').parents('.label_popup').fadeOut();
				})
				cs.closePop();
			} else if(status == 0){
                bootbox.confirm('确认撤销审批？', function(flag){
                    if(flag){
                        setStatus(data);
                    }
                })
            }else {
				setStatus(data);
			}
		}

		function setStatus(data) {
			ykp.doAjax({
				url: data.url,
				methods: data.methods,
				data: data.data,
				success: function(res) {
					ykp.prompt('审批成功!');
					getList();
				}
			})
		}
		//自定义table
		cs.custorm_check('#dynamic-table', '#datalist', false);


		// $('.add').click(function() {
		// 	showMark('.popup_new');
		// });
	});
</script>